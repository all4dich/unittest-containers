#!/bin/bash
git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git ${HOME}/.local/depot_tools
chmod +x ${HOME}/.local/depot_tools/*
export PATH="$PATH:${HOME}/.local/depot_tools"
if [ -d build ]; then
echo "A directory './build' exists. Delete it before triggering run-test.sh"
exit 1
fi
/tools/set-run-test-env.sh
sudo mkdir build
sudo chown `id -u`:staff build
pushd build
mkdir ${HOME}/.config/chromium79 -p
git clone -b @1.jcl4tv ssh://gpro.lge.com/webos-pro/chromium79 
cd chromium79/src
./build/linux/sysroot_scripts/install-sysroot.py --arch=amd64
git clone -b @chromium79 ssh://gpro.lge.com/webosose/chromium-v8 v8
git clone ssh://wall.lge.com:29448/app/com.webos.app.crow crow
gn gen out/Default --args="enable_crow = true use_cbe = true use_v8_context_snapshot = true is_webos = false use_neva_appruntime = false use_neva_media = false use_webos_tv_media = false enable_hbbtv = false enable_inettv = false enable_hybridcast = false enable_dcsjp = false enable_dmost = false treat_warnings_as_errors = false enable_nacl = false enable_remoting = false use_lld = false is_debug = false"
autoninja -C out/Default crow_unittests
./out/Default/crow_unittests --gtest_filter=-AdServiceTest.ClickAdBannerTest:AdServiceTest.ResetBannerInfoTest:AdServiceTest.UpdateBannerInfoTest:BookmarkPageViewTest.DeleteTest:BookmarkPageViewTest.EmptyTest:BookmarkPageViewTest.LabelTest:BookmarkPageViewTest.SelectTest:BrowserTest.BrowserInstanceTest:BrowserTest.BrowserStateTest:BrowserTest.CloseBrowser:BrowserTest.CursorVisibilityChanged:BrowserTest.HandleMemory:BrowserTest.HandleMrcuState:BrowserTest.HandlePowerState:BrowserTest.InputPanelRectChanged:BrowserTest.InputPanelVisibilityChanged:BrowserTest.InvokeService:BrowserTest.NotifyCloseBrowser:BrowserTest.OnSessionConfirmClosed:BrowserTest.RelaunchBrowser:BrowserTest.SendHint:BrowserTest.SendReport:BrowserTest.SetCountry:BrowserTest.SetCountryGroup:BrowserTest.SetLocale:BrowserTest.ShowSessionConfirm:BrowserTest.ShowToast:BrowserTest.UpdateAppInfo:ButtonsTest.AdsBlockButtonTest:ButtonsTest.CheckButtonTest:ButtonsTest.ChooseButtonTest:ButtonsTest.ImageButtonTest:ButtonsTest.LabelButtonTest:ContentContainerManagerTest.CreateTest:ContentContainerManagerTest.ShowNativePageTest:ContentContainerManagerTest.TabObserverTest:ContentContainerManagerTest.WebViewContainerTest:ContentContainerTest.AddNativePageTest:ContentContainerTest.CreateTest:ContentContainerTest.GoBackForwardTest:ContentContainerTest.ShowContentTestForCrowNativeViewType:ContentContainerTest.ShowContentTestForWebView:ControlBarTest.InitTest:ControlBarTest.ShowHideTest:CrowAXEventObserverTest.OnViewEventTest:CrowJavaScriptAppModalDialogTest.CallDialogClosedCallback:CrowJavaScriptAppModalDialogTest.NotifyDelegate:CrowJavaScriptDialogManagerTest.GetTitle:CrowJavaScriptDialogManagerTest.OnDialogClosed:CrowJavaScriptDialogManagerTest.RunBeforeUnloadDialog:CrowJavaScriptDialogManagerTest.RunJavaScriptDialog:CrowLabelTest.AddChildViewTest:CrowLabelTest.FontPropertyTest:CrowLabelTest.MessageIdPropertyTest:CrowLabelTest.TextPropertyTest:CrowLocalizedErrorTest.CrowLocalizedError:CrowNativeViewTest.DisableHeaderTest:CrowNativeViewTest.EndableHeaderTest:CrowNativeViewTest.KeyEventFocusTest:CrowNativeViewTest.WrongTitleTest:CrowPermissionTest.GetPermissionStatus_AV:CrowPermissionTest.GetPermissionStatus_Geo:CrowPermissionTest.GetPermissionStatus_NO_WHITE:CrowPermissionTest.GetPermissionStatus_WHITE:CrowPermissionTest.RequestPermission_all:CrowZoomUITest.zoom:EfsSubscriberTest.callback_efs_off_flow:EfsSubscriberTest.callback_efs_on_flow:EventHandlerTest.CanDispatchEvent:EventHandlerTest.DispatchEvent:EventHandlerTest.NotifyKeyEvent:EventHandlerTest.NotifyMouseEvent:EventHandlerTest.SetDelegate:HistoryPageViewTest.AccessibilityTest:HistoryPageViewTest.DeleteTest:HistoryPageViewTest.EmptyTest:HistoryPageViewTest.LabelTest:HistoryPageViewTest.SelectTest:LocationBarTest.GetAccessibleNodeDataTest:LocationBarTest.InitTest:LocationBarTest.ShowHideTest:MemorySubscriberTest.callback_flow:MenuPopupTest.AccessibilityTest:MenuPopupTest.FunctionTest:ModalDialogEventBlockerTest.OnKeyEvent:ModalDialogEventBlockerTest.OnMouseEvent:ModalDialogEventBlockerTest.OnScrollEvent:ModalDialogEventBlockerTest.OnTouchEvent:ModalDialogEventBlockerTest.ShouldStopPropagationTo:NewtabPageViewTest.AdSponsorTest:NewtabPageViewTest.DeleteMVSTest:NewtabPageViewTest.LoadMostVisitedTest:NewtabPageViewTest.NewTabPageLayoutTest:NewtabPageViewTest.PagItemViewTypeTest:NewtabPageViewTest.RecommendedTest:NrcuCursorTest.CreateWidgetTest:NrcuCursorTest.KeyEventBaseTest:NrcuCursorTest.KeyEventNonRepeatTest:NrcuCursorTest.KeyEventRepeatTest:NrcuCursorTest.ScrollViewScrollTest:NrcuCursorTest.SetStateTest:NrcuCursorTest.ShowHideTest:OmniboxPopupViewTest.AnimationCanceled:OmniboxPopupViewTest.AnimationEnded:OmniboxPopupViewTest.AnimationProgressed:OmniboxPopupViewTest.ButtonPressed:OmniboxPopupViewTest.CalculatePreferredSize:OmniboxPopupViewTest.ContentsChanged:OmniboxPopupViewTest.GetClassName:OmniboxPopupViewTest.Init:OmniboxPopupViewTest.IsVisible:OmniboxPopupViewTest.OnPaintBackground:OmniboxPopupViewTest.OnUpOrDownKeyPressed:OmniboxPopupViewTest.PaintFocused:OmniboxPopupViewTest.SetPopupBounds:OmniboxPopupViewTest.UpdatePopup:OmniboxResultViewTest.AnimationProgressed:OmniboxResultViewTest.CalculatePreferredSize:OmniboxResultViewTest.GetAccessibleNodeData:OmniboxResultViewTest.GetClassName:OmniboxResultViewTest.GetIcon:OmniboxResultViewTest.GetKeywordIcon:OmniboxResultViewTest.Layout:OmniboxResultViewTest.OnBoundsChanged:OmniboxResultViewTest.OnThemeChanged:OmniboxResultViewTest.PaintButtonContents:OmniboxResultViewTest.SetSelected:OmniboxResultViewTest.ShowKeyword:OmniboxViewTest.AcceptInput:OmniboxViewTest.ContentsChanged:OmniboxViewTest.GetAccessibleNodeData:OmniboxViewTest.GetClassName:OmniboxViewTest.HandleKeyEvent:OmniboxViewTest.Init:OmniboxViewTest.IsValid:OmniboxViewTest.OnBlur:OmniboxViewTest.OnFocus:OmniboxViewTest.SetText:OmniboxViewTest.UpdateSecurityLevel:OsInfoSubscriberTest.CallbackTestDefault:OsInfoSubscriberTest.CallbackTestReturnValueFalse:OsInfoSubscriberTest.CallbackTestReturnValueTrue:PipPlayerLunaCallTest.ChangeChannelDown:PipPlayerLunaCallTest.ChangeChannelUp:PipPlayerLunaCallTest.OpenBroadcast:PipPlayerLunaCallTest.OpenExternalDevice:PipPlayerTest.CreatePlayerTest:PipPlayerTest.PipViewTest:PipPlayerTest.ResetRecentPlayer:PipPlayerTest.ShutDownPIP:ResourceManagerTest.CreateTest:ResourceManagerTest.GetImageSkiaNamedTest:ResourceManagerTest.LoadBitmap2Test:ResourceManagerTest.LoadBitmapTest:ResourceManagerTest.SaveImageFileTest:SdpDownloaderTest.CheckResourceVersion:SdpDownloaderTest.CheckResourceVersionFailFormat:SdpDownloaderTest.CheckResourceVersionFailVersion:SdpDownloaderTest.GetCurrentVersionFail:SdpDownloaderTest.Init:SdpDownloaderTest.IsDownloadedDataValid:SdpDownloaderTest.OnGetSdpResourceInfo:SdpDownloaderTest.OnURLFetchComplete:SdpDownloaderTest.OnURLFetchCompleteFail:SdpDownloaderTest.RemoveWord:SdxPublishFlagSubscriberTest.CallbackPublishFlagFalse:SdxPublishFlagSubscriberTest.CallbackPublishFlagTrue:SdxPublishFlagSubscriberTest.CallbackReturnValueFalse:SdxServerSubscriberTest.CallbackReturnValueFalse:SdxServerSubscriberTest.CallbackServerIndexProduction:SdxServerSubscriberTest.CallbackServerIndexQA2:SettingPageViewTest.AccessibilityTest:SettingPageViewTest.ClearBrowsingDataTest:SettingPageViewTest.FunctionTest:SettingPageViewTest.LabelTest:SettingPageViewTest.PopupTest:SiteFilterViewTest.AddApprovedSiteItemTest:SiteFilterViewTest.LabelsTest:SiteFilterViewTest.RadioButtonOfSiteFilterTypeTest:SiteFilterViewTest.RemoveApprovedSiteItemTest:SystemInfoSubscriberTest.CallbackDefault:SystemInfoSubscriberTest.CallbackReturnValueFalse:SystemInfoSubscriberTest.CallbackReturnValueTrue:ToolBarTest.AccessibilityTest:ToolBarTest.FunctionTest:VoiceBrowsingTest.BookmarkPageTest:VoiceBrowsingTest.CheckUiIntent:VoiceBrowsingTest.HistoryPageTest:VoiceBrowsingTest.NewTabPageTest:VoiceBrowsingTest.SettingkPageTest
RETURN_CODE=$?
sudo chown -R "root:root" /work/build
echo "INFO: Final exit code: ${RETURN_CODE}"
exit $RETURN_CODE
